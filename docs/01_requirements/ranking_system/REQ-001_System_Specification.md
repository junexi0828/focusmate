# 랭킹전 시스템 상세 기획서

## 📋 목차
1. [개요](#개요)
2. [시스템 구조](#시스템-구조)
3. [팀 시스템](#팀-시스템)
4. [학교 인증](#학교-인증)
5. [미니게임](#미니게임)
6. [명예의 전당](#명예의-전당)
7. [데이터베이스 설계](#데이터베이스-설계)
8. [UI/UX 설계](#uiux-설계)
9. [구현 단계](#구현-단계)

---

## 개요

### 목적
- 사용자 간 경쟁을 통한 동기부여 강화
- 팀 단위 협업 학습 문화 조성
- 게임화(Gamification)를 통한 지속적인 참여 유도

### 핵심 특징
- 🏆 **팀 기반 경쟁**: 4인 이상 팀 구성
- 🎓 **학교 인증**: 관리자 승인 시스템
- 🎮 **미니게임**: 휴식 시간 활용
- 🏅 **명예의 전당**: 실시간 순위 시스템
- 📊 **독립 DB**: 일반 통계와 분리

---

## 시스템 구조

### 네비게이션 구조
```
사이드바
├── 대시보드 (기존)
├── 통계 (기존)
└── 랭킹전 (신규)
    ├── 내 팀
    ├── 명예의 전당
    ├── 미니게임
    └── 팀 관리
```

### 데이터 분리
- **일반 모드**: 개인 통계, 목표 관리
- **랭킹전 모드**: 팀 통계, 경쟁 기록
- 두 모드는 완전히 독립적인 DB 사용

---

## 팀 시스템

### 1. 팀 유형

#### 4가지 소속 카테고리
1. **일반**: 제한 없음, 누구나 참여 가능
2. **학과**: 동일 학과 학생들로 구성
3. **연구실**: 동일 연구실 소속
4. **동아리**: 동일 동아리 회원

### 2. 팀 구성 규칙

#### 최소 인원
- **4명 이상** 필수
- 최대 인원: **8명** (권장)

#### 팀 생성 프로세스
1. 팀장이 팀 생성 (소속 선택)
2. 팀원 초대 (이메일 또는 코드)
3. 팀원 수락
4. 학교 인증 신청 (학과/연구실/동아리만)
5. 관리자 승인 대기
6. 승인 완료 → 랭킹전 참여 가능

### 3. 팀 역할

#### 팀장 (Leader)
- 팀 생성 및 관리
- 팀원 초대/제명
- 학교 인증 신청
- 미니게임 참가 여부 결정

#### 팀원 (Member)
- 세션 참여
- 미니게임 참여
- 팀 통계 기여

---

## 학교 인증

### 1. 인증 대상
- **학과** 팀
- **연구실** 팀
- **동아리** 팀
- **일반** 팀은 인증 불필요

### 2. 인증 프로세스

#### 신청 단계
1. 팀장이 인증 신청
2. 필수 제출 서류:
   - 학생증 사본 (전체 팀원)
   - 소속 증명서 (학과/연구실/동아리)
   - 팀원 명단

#### 관리자 검토
- 서류 확인
- 소속 진위 여부 확인
- 승인/반려 결정

#### 승인 후
- 팀 상태: `pending` → `verified`
- 랭킹전 참여 가능
- 명예의 전당 등록

### 3. 인증 상태

| 상태 | 설명 | 랭킹전 참여 |
|------|------|------------|
| `pending` | 승인 대기 | ❌ |
| `verified` | 승인 완료 | ✅ |
| `rejected` | 반려 | ❌ |
| `none` | 일반 팀 | ✅ |

---

## 미니게임

### 1. 게임 타이밍
- **휴식 시간마다** 자동 시작
- 포모도로 세션 완료 후
- 선택 참여 (팀 설정)

### 2. 게임 유형

#### 타입 1: 퀴즈 게임
- 집중력 관련 퀴즈
- 제한 시간: 30초
- 정답 시 팀 점수 +10

**예시 문제**:
- "포모도로 기법의 기본 집중 시간은?"
- "효과적인 휴식 방법은?"

#### 타입 2: 반응 속도 게임
- 화면에 나타나는 아이콘 클릭
- 반응 시간 측정
- 빠를수록 높은 점수

#### 타입 3: 기억력 게임
- 카드 뒤집기
- 짝 맞추기
- 제한 시간 내 완료

### 3. 게임 점수 시스템

#### 개인 점수
- 게임 성공: +10점
- 게임 실패: 0점
- 빠른 완료: 보너스 +5점

#### 팀 점수
- 팀원 개인 점수 합산
- 주간 누적
- 월간 누적

### 4. 참여 규칙
- 팀 설정에서 참여 여부 선택
- 참여 안 함: 점수 없음, 순위 영향 없음
- 참여 함: 모든 팀원 필수 참여

---

## 명예의 전당

### 1. 구조

#### 3가지 리더보드
1. **순공부시간 랭킹**
2. **연속 성공 랭킹**
3. **미니게임 랭킹**

### 2. 순공부시간 랭킹

#### 계산 방식
- 팀원 전체의 집중 시간 합산
- 휴식 시간 제외
- 주간/월간 집계

#### 순위 기준
```
팀 순공부시간 = Σ(팀원별 집중 시간)
```

#### 표시 정보
- 순위
- 팀명
- 소속 (일반/학과/연구실/동아리)
- 총 집중 시간
- 팀원 수
- 평균 집중 시간 (총 시간 / 팀원 수)

### 3. 연속 성공 랭킹

#### 연속 성공 정의
- 모든 팀원이 목표 시간 달성
- 하루도 빠짐없이 연속

#### 계산 방식
```
연속 성공일 = 연속으로 목표 달성한 날짜 수
```

#### 목표 기준
- 팀별 설정 가능
- 기본: 일일 2시간
- 모든 팀원이 달성해야 카운트

#### 표시 정보
- 순위
- 팀명
- 연속 성공 일수
- 현재 스트릭 상태 (🔥)

### 4. 미니게임 랭킹

#### 계산 방식
- 주간 미니게임 점수 합산
- 팀원 개인 점수 합계

#### 순위 기준
```
팀 미니게임 점수 = Σ(팀원별 미니게임 점수)
```

#### 표시 정보
- 순위
- 팀명
- 총 점수
- 게임 참여율 (참여 횟수 / 총 기회)
- 평균 점수

### 5. 기간별 랭킹

#### 주간 랭킹
- 월요일 00:00 ~ 일요일 23:59
- 매주 월요일 초기화

#### 월간 랭킹
- 매월 1일 00:00 ~ 말일 23:59
- 매월 1일 초기화

#### 전체 랭킹
- 시즌별 (3개월)
- 누적 기록

---

## 데이터베이스 설계

### 1. 랭킹전 전용 테이블

#### `ranking_teams` (팀 정보)
```sql
CREATE TABLE ranking_teams (
  team_id UUID PRIMARY KEY,
  team_name VARCHAR(100) NOT NULL,
  team_type ENUM('general', 'department', 'lab', 'club'),
  verification_status ENUM('none', 'pending', 'verified', 'rejected'),
  leader_id UUID REFERENCES users(user_id),
  mini_game_enabled BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### `ranking_team_members` (팀원)
```sql
CREATE TABLE ranking_team_members (
  member_id UUID PRIMARY KEY,
  team_id UUID REFERENCES ranking_teams(team_id),
  user_id UUID REFERENCES users(user_id),
  role ENUM('leader', 'member'),
  joined_at TIMESTAMP DEFAULT NOW()
);
```

#### `ranking_sessions` (랭킹전 세션)
```sql
CREATE TABLE ranking_sessions (
  session_id UUID PRIMARY KEY,
  team_id UUID REFERENCES ranking_teams(team_id),
  user_id UUID REFERENCES users(user_id),
  duration_minutes INT NOT NULL,
  session_type ENUM('work', 'break'),
  completed_at TIMESTAMP DEFAULT NOW()
);
```

#### `ranking_mini_games` (미니게임 기록)
```sql
CREATE TABLE ranking_mini_games (
  game_id UUID PRIMARY KEY,
  team_id UUID REFERENCES ranking_teams(team_id),
  user_id UUID REFERENCES users(user_id),
  game_type VARCHAR(50),
  score INT DEFAULT 0,
  success BOOLEAN DEFAULT false,
  played_at TIMESTAMP DEFAULT NOW()
);
```

#### `ranking_leaderboard` (리더보드 캐시)
```sql
CREATE TABLE ranking_leaderboard (
  leaderboard_id UUID PRIMARY KEY,
  team_id UUID REFERENCES ranking_teams(team_id),
  ranking_type ENUM('study_time', 'streak', 'mini_game'),
  period ENUM('weekly', 'monthly', 'all_time'),
  score DECIMAL(10, 2),
  rank INT,
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### `ranking_verification_requests` (인증 요청)
```sql
CREATE TABLE ranking_verification_requests (
  request_id UUID PRIMARY KEY,
  team_id UUID REFERENCES ranking_teams(team_id),
  documents JSONB, -- 제출 서류 URL
  status ENUM('pending', 'approved', 'rejected'),
  admin_note TEXT,
  submitted_at TIMESTAMP DEFAULT NOW(),
  reviewed_at TIMESTAMP
);
```

---

## UI/UX 설계

### 1. 랭킹전 메인 페이지

#### 레이아웃
```
┌─────────────────────────────────────┐
│  랭킹전                              │
├─────────────────────────────────────┤
│  [내 팀] [명예의 전당] [미니게임]    │
├─────────────────────────────────────┤
│                                     │
│  내 팀 정보 카드                     │
│  ┌──────────────────────────────┐  │
│  │ 팀명: 코딩마스터즈             │  │
│  │ 소속: 컴퓨터공학과             │  │
│  │ 팀원: 4명                     │  │
│  │ 이번 주 순위: 🥈 2위          │  │
│  └──────────────────────────────┘  │
│                                     │
│  주간 통계                          │
│  ┌──────────────────────────────┐  │
│  │ 총 집중 시간: 48.5시간        │  │
│  │ 연속 성공: 🔥 7일             │  │
│  │ 미니게임 점수: 350점          │  │
│  └──────────────────────────────┘  │
└─────────────────────────────────────┘
```

### 2. 명예의 전당 페이지

#### 탭 구조
- **순공부시간** (기본)
- **연속 성공**
- **미니게임**

#### 리더보드 디자인
```
┌─────────────────────────────────────┐
│  명예의 전당 - 순공부시간            │
├─────────────────────────────────────┤
│  [주간] [월간] [전체]                │
├─────────────────────────────────────┤
│  🥇 1위  코딩마스터즈  (컴공)        │
│         총 52.3시간 | 평균 13.1h     │
├─────────────────────────────────────┤
│  🥈 2위  알고리즘킹  (전자)          │
│         총 48.7시간 | 평균 12.2h     │
├─────────────────────────────────────┤
│  🥉 3위  데이터사이언스  (통계)      │
│         총 45.2시간 | 평균 11.3h     │
└─────────────────────────────────────┘
```

### 3. 미니게임 페이지

#### 게임 선택 화면
```
┌─────────────────────────────────────┐
│  미니게임                            │
├─────────────────────────────────────┤
│  다음 게임까지: 23:45               │
├─────────────────────────────────────┤
│  ┌──────────┐  ┌──────────┐        │
│  │  퀴즈     │  │ 반응속도  │        │
│  │  게임     │  │  게임     │        │
│  └──────────┘  └──────────┘        │
│                                     │
│  ┌──────────┐                       │
│  │ 기억력    │                       │
│  │  게임     │                       │
│  └──────────┘                       │
└─────────────────────────────────────┘
```

### 4. 팀 관리 페이지

#### 팀 생성
```
┌─────────────────────────────────────┐
│  팀 생성                             │
├─────────────────────────────────────┤
│  팀명: [____________]               │
│  소속: [일반 ▼]                     │
│  미니게임 참여: [✓]                 │
│                                     │
│  팀원 초대                          │
│  [이메일 입력] [초대하기]           │
│                                     │
│  [생성하기] [취소]                  │
└─────────────────────────────────────┘
```

---

## 구현 단계

### Phase 1: 기본 팀 시스템 (2주)
- [ ] 팀 생성/수정/삭제 API
- [ ] 팀원 초대/수락/탈퇴 API
- [ ] 팀 목록 조회 API
- [ ] 팀 상세 정보 UI

### Phase 2: 학교 인증 시스템 (1주)
- [ ] 인증 요청 API
- [ ] 관리자 승인 페이지
- [ ] 서류 업로드 기능
- [ ] 인증 상태 관리

### Phase 3: 랭킹전 세션 (2주)
- [ ] 랭킹전 세션 기록 API
- [ ] 팀 통계 계산 로직
- [ ] 실시간 데이터 동기화
- [ ] 세션 기록 UI

### Phase 4: 미니게임 (3주)
- [ ] 퀴즈 게임 구현
- [ ] 반응속도 게임 구현
- [ ] 기억력 게임 구현
- [ ] 게임 점수 시스템
- [ ] 게임 UI/UX

### Phase 5: 명예의 전당 (2주)
- [ ] 리더보드 계산 로직
- [ ] 실시간 순위 업데이트
- [ ] 3가지 랭킹 UI
- [ ] 기간별 필터링
- [ ] 순위 변동 알림

### Phase 6: 최적화 및 테스트 (1주)
- [ ] 성능 최적화
- [ ] 캐싱 전략
- [ ] 부하 테스트
- [ ] 버그 수정

---

## 기술 스택

### Frontend
- **React 18**: UI 프레임워크
- **TanStack Query**: 실시간 데이터 동기화
- **Socket.io**: 실시간 순위 업데이트
- **Recharts**: 팀 통계 차트
- **Framer Motion**: 게임 애니메이션

### Backend
- **FastAPI**: REST API
- **PostgreSQL**: 메인 데이터베이스
- **Redis**: 리더보드 캐싱
- **WebSocket**: 실시간 통신

---

## 보안 고려사항

### 1. 팀 인증
- 서류 검증 프로세스
- 관리자 권한 관리
- 인증 만료 정책

### 2. 게임 부정 방지
- 클라이언트 검증
- 서버 사이드 점수 계산
- 이상 패턴 감지

### 3. 데이터 무결성
- 트랜잭션 관리
- 동시성 제어
- 데이터 백업

---

## 성공 지표 (KPI)

### 1. 참여율
- 랭킹전 참여 팀 수
- 주간 활성 팀 비율
- 미니게임 참여율

### 2. 사용자 만족도
- 팀 유지율
- 평균 세션 시간
- 재방문율

### 3. 경쟁 효과
- 평균 집중 시간 증가율
- 목표 달성률
- 연속 성공 일수

---

## 향후 확장 계획

### 1. 시즌 시스템
- 3개월 단위 시즌
- 시즌별 보상
- 시즌 종료 이벤트

### 2. 업적 시스템
- 팀 업적
- 개인 업적
- 특별 칭호

### 3. 소셜 기능
- 팀 채팅
- 응원 메시지
- 팀 프로필 커스터마이징

---

**작성일**: 2025-01-12
**버전**: 1.0
**작성자**: Focus Mate 기획팀
